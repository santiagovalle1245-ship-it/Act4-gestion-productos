<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mis Productos</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f2f5; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #007bff; color: white; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>Gestión de Productos</h2>
    
    <div class="card">
        <h3>Agregar Nuevo Producto</h3>
        <input type="text" id="nombre" placeholder="Nombre (ej. Laptop)">
        <input type="text" id="desc" placeholder="Descripción">
        <input type="number" id="precio" placeholder="Precio">
        <button onclick="agregarProducto()">Guardar Producto</button>
    </div>

    <table id="tablaProductos">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Precio</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const token = localStorage.getItem('token'); // Recuperamos la "pulsera" del login

        // 1. Función para cargar productos desde el servidor
        async function cargarProductos() {
            const res = await fetch('/api/products', {
                headers: { 'Authorization': `Bearer ${token}` } // Enviamos el token para que el servidor nos deje pasar
            });
            const productos = await res.json();
            const cuerpoTabla = document.querySelector('#tablaProductos tbody');
            cuerpoTabla.innerHTML = ""; // Limpiar tabla
            
            productos.forEach(p => {
                // Ajuste: Se usan los nombres de campos en inglés para coincidir con Atlas
                cuerpoTabla.innerHTML += `<tr><td>${p.name}</td><td>${p.description}</td><td>$${p.price}</td></tr>`;
            });
        }

        // 2. Función para enviar un producto nuevo a MongoDB
        async function agregarProducto() {
            const nombre = document.getElementById('nombre').value;
            const descripcion = document.getElementById('desc').value;
            const precio = document.getElementById('precio').value;

            await fetch('/api/products', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` 
                },
                // Ajuste: Se mapean los datos a las llaves 'name', 'description' y 'price'
                body: JSON.stringify({ name: nombre, description: descripcion, price: precio })
            });
            
            alert("Producto guardado!");
            cargarProductos(); // Recargamos la tabla para ver el cambio
        }

        // Cargar al abrir la página
        cargarProductos();
    </script>
</body>
</html>